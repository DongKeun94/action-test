name: Deploy to SPC with OIDC

on:
  push:
    branches:
      - master

permissions:
  id-token: write
  contents: read

jobs:
  deploy-to-spc:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: SPC OIDC Login
        run: ./oidc.sh "${{ secrets.SPC_ROLE_ARN }}" "https://sts.samsungspc.com"

      - name: Upload file to SPC S3
        run: |
          export AWS_RESPONSE_CHECKSUM_VALIDATION=when_required
          export AWS_REQUEST_CHECKSUM_CALCULATION=when_required

          aws s3 cp text.txt s3://dsung-dx-test-2/oidcTest/ \
            --endpoint-url https://s3.us-east-1.samsungspc.com \
            --region us-east-1

name: Deploy to SPC

on:
  push:
    branches:
      - master

permissions:
  id-token: write
  contents: read

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      # 1️⃣ 코드 체크아웃
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2️⃣ SPC OIDC 로그인 (Docker 액션 사용)
      - name: SPC OIDC Login
        uses: DongKeun94/spc-oidc@master
        with:
          role_arn: ${{ secrets.SPC_ROLE_ARN }}
          sts_endpoint: https://sts.samsungspc.com

      # 3️⃣ SPC S3 업로드
      - name: Upload TXT files to SPC S3
        run: |
          export AWS_RESPONSE_CHECKSUM_VALIDATION=when_required
          export AWS_REQUEST_CHECKSUM_CALCULATION=when_required
          
          aws s3 cp *.txt s3://dsung-dx-test-2/oidcTest/ \
            --endpoint-url https://s3.us-east-1.samsungspc.com \
            --region us-east-1
